浅谈机器人仿真

作者：RxDUty
链接：https://zhuanlan.zhihu.com/p/104177801
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。



仿真是机器人学习和研究过程中最重要的工具之一。很多初学者可能还没有使用过机器人仿真软件，或者有些同学虽然听说甚至接触过仿真但是并没有形成清晰的认识，本文旨在探讨机器人仿真最基础的一些问题，希望能对想要进一步学习机器人或者了解机器人仿真的同学有所启发。为什么需要仿真可能很多人的第一个疑问就是为什么我们需要做仿真？与其花那么多时间去构建仿真为什么不直接把硬件平台搭出来然后直接在实际平台上做开发和调试呢？对于大部分爱好者级别的机器人来说，可能仿真的重要性确实不那么大，淘宝上买一个套件，或者自己3D打印机械零部件，然后装上电机/舵机，搭上Arduino或者STM32的控制板，就可以开始调试程序了。低成本、面向个人爱好或者竞赛的小型机器人，这样的开发流程可能确实效率最高。但是随着机器人的复杂度增加，项目参与人数增多，任务分工更加细化，先搭硬件平台再做软件开发模式的弊端就会逐渐显露出来：首先，在没有仿真的情况下，软件开发很容易会滞后。虽然在等待硬件定型的过程中依然可以进行软件结构的设计、甚至具体功能模块的构建，但是由于缺乏有效的反馈，这个过程中开发的东西很容易跟实际系统产生脱节，等到在实际系统上做测试的时候，部分组件甚至会需要推倒重来，之前的部分工作量一定程度上就浪费了。可能很多参与机器人竞赛的同学都遇到过硬件开发时间超出预期，结果没有时间调试和优化软件的情况。其次，硬件设计、尤其是加工和组装往往比较耗时，如果不能一次成功，搭建平台->调试->迭代改进的周期很容易就会拖得比较长，软硬件开发的进度都会变得很难把控。最后，很多个人或团队不具备搭建硬件平台的条件，或者项目的重点对硬件平台的要求不那么高，例如上层算法设计这类工作，这种情况下搭建平台的成本很高而如果不构建仿真又很难对项目工作进行量化的评估。对于个人学习者来说这个问题尤其明显，平衡小车或者小四轴这类相对还比较容易负担的起，但是工业机械臂、激光雷达这类动辄几千上万的设备，如果不依托于实验室可能很多人即使感兴趣也很难有机会接触，而仿真则提供了一个廉价的学习环境。**仿真的主要意义不在于取代实际的硬件，而在于提供一个一致性较好、不确定因素可控的评估对象/环境。**当前的仿真还很难做到跟实际系统完全一致，但是合理的仿真模型可以抓住被仿对象的主要特征，开发人员可以利用仿真平台完成初步的开发与评估，然后再转移到实际平台做进一步的调试和优化。项目初期以及项目进行阶段开发新功能的过程中不确定因素很多，算法的正确性和具体编程实现的正确性很难直接划等号，使用仿真调试和评估可以大大缩短迭代周期，避免了很小的软件改动也得花很多时间准备硬件以及测试环境，同时也能最大限度避免低级错误导致的硬件损坏。举个例子，在参与DARPA机器人大赛的过程中，做一次在Atlas机器人上的测试至少需要一名在电脑前的操作员，以及一名负责牵引机器人绳索防止Atlas摔倒的安全员。除了测试过程中的人力和时间消耗，由于多个子任务的小团队都有测试任务，项目进行最紧张的时期很难想测试就能立即能分配到测试时间，不同子任务测试的切换有时候也需要调整测试区域场景道具。仿真在这种情况下就能起到很好的协调和缓冲作用，把大部分低级错误在仿真阶段就排除，然后在实机测试的时候重点检查算法的正确性。仿真”仿“的是什么既然仿真的目的是为了帮助评估机器人结构和算法的设计，那么很自然“仿”的对象主要有以下几个方面：机器人本体的运动学和动力学特性：例如移动机器人在二维平面的运动，机械臂的关节及末端执行机构的运动，飞行器在空间的运动机器人工作的环境：如工业流水线场景，无人驾驶出租车所在的市内交通环境传感器：如特定视角下机器人“看”到的彩色/深度图像，激光雷达扫描到的距离点对机器人本体运动的仿真过程可能是大多数人最容易理解的，我们从初高中物理就开始学习质点和刚体的简单运动模型，仿“机器人的运动”本质上就是先对机器人建模得到运动学和动力学模型，然后利用模型“预测”给了特定的输入（如力和力矩）后实际的机器人应该有怎么样的运动表现。如果模型建立的足够准确，那么“预测”出来的运动应该跟实际机器人的表现非常接近。“仿”运动的过程可以简单概括为“建立模型->给定输入，求解模型输出->通过曲线或2D/3D图形图像呈现结果”的过程。当然，怎样建立和描述模型（ODE/PDE)，给定输入怎样求解(数值计算方法)，怎么可视化求解的中间变量和最终结果就需要根据实际项目来决定了，后续的文章会通过具体的例子来说明。有了运动过程的仿真计算，一部分“测量模型可以利用机器人系统状态变量来直接表达”的传感器的仿真也就很容易做到了，实际使用中我们往往还会在计算得到的理想传感器“测量”数据中人为的加入噪声来使得数据更接近实际测量数值的特征。对于诸如摄像头这类传感器，仿真的实现则需要通过计算机图形计算来得到特定视角下场景的呈现结果，类似的我们也可以人为的加入噪点或畸变以使得采集的图像不那么完美。机器人仿真的实现涉及到很多方面的知识，这也是为什么会有专门研发仿真系统的团队，例如DARPA机器人大赛过程中DARPA就花了很多钱资助OSRF开发和维护Atlas机器人基于Gazebo的仿真。近几年无人驾驶的研发也促成了如Microsoft AirSim，Carla这类包含了拟真度较高的车辆动力学/交通环境/传感器等模型的综合仿真软件平台。常用的机器人仿真软件说起机器人仿真软件，可能很多人都知道Gazebo，一部分原因也是由于ROS在这几年很流行，虽然Gazebo可以独立于ROS运行但是大多数仿真应用下两者都是同时出现的。除了Gazebo，一些特定机器人应用领域也会有专门的仿真软件，如工业机械臂厂家提供的仿真。在此我们简单总结对比一下三款常见的通用机器人仿真软件平台：Gazebo， VREP和Webots。这三款都是开源软件（VREP有商业License选项），因此对学习者都非常友好，功能无限制，其中Gazebo和Webots的开源License很宽松因而也适合商业应用。1. Gazebo：可能是三者中最广为人知的一个，但是从本人使用体验来看也是功能和文档最差的一个（VREP和Webots早期都是商业软件，因此不管是features还是配套的说明文档都更丰富和完善）。实际项目中如果使用的机器人平台厂家提供了Gazebo仿真软件包，或者在网上能找到类似的参考，Gazebo还是一个很不错的选择，尤其是项目如果使用ROS框架，仿真部分的配置和使用跟其他ROS Package的一致性非常好。但是如果需要自己搭建仿真，尤其是软件框架不准备使用ROS的情况下，那么不妨看一看VREP和Webots。2. VREP：19年年底VREP已经更名为CoppeliaSim，但是软件界面和功能和之前的版本变化并不大。在VREP中构建机器人模型的过程是三个软件中最为直观和简单的，从机器人的机械模型（如stl，step格式的CAD文件)可以很快的搭建出漂亮的仿真模型。VREP提供的编程接口也很多样，Matlab/C/C++/Python/Java都支持。在我以往的使用过程中最常用的是VREP的remote API，这种方式可以把仿真和视觉/控制/规划等功能代码比较清晰的隔离开，更方便在仿真机器人和实际机器人间做切换，但是这种交互方式下传感器数据，尤其是点云/图片类的数据传递起来稍微有些繁琐，因此如果你的项目需要很多这种视觉类传感器的仿真，那么Gazebo或者Webots可能就更合适。3. Webots：近一两年才由商业软件模式改为开源模式，Webots综合了很多Gazebo和VREP功能上的优点，因而也是我目前最推荐学习的一款软件。Webots目前最大的问题在于参考资料较少，虽然文档还算详细，但是学习曲线会比VREP更陡峭一些。我目前的项目中主要使用Webots的C++ API和ROS API，两者在“仿真代码”和“上层功能代码”关系的处理上都把握的很好，传感器数据的获取以及仿真部分代码添加外部依赖库的处理也很方便。除了以上三个软件，对于无人驾驶类的应用感兴趣的同学也可以看一看AirSim，Carla等，这类软件一般采用的结构是：使用游戏引擎搭建仿真环境以达到逼真的图像类感知效果，独立开发或使用第三方动力学仿真模型来模拟车辆的运动。如果单独对traffic flow感兴趣，可以搜一搜了解一下SUMO。小结仿真在复杂的机器人项目中可以有效的帮助提高开发和测试效率，使得开发者在实机测试和部署之前尽可能多的发现错误，在系统出现问题之后更方便的0复现和解决问题，同时还有利于同一个项目中不同的小团队（例如软件组和硬件组）协调工作进度。但是，天下没有免费的午餐，构建和维护仿真也需要额外的工作量，因此开发团队需要针对项目需求评估和选择合适的仿真平台以最大化投入的时间和收益。

[发布于 01-29](http://zhuanlan.zhihu.com/p/104177801)